<!DOCTYPE html>
<html>
<head>
<!-- Based on demo found here:
http://wiki.ros.org/roslibjs/Tutorials/BasicRosFunctionality
http://wiki.ros.org/roslibjs/Tutorials/BasicRosFunctionality
-->

<!--
The next two lines bring in the JavaScript files that support rosbridge integration.
-->
<script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
<script type="text/javascript" src="http://static.robotwebtools.org/mjpegcanvasjs/current/mjpegcanvas.min.js"></script>
<script type="text/javascript" type="text/javascript">

// This function connects to the rosbridge server running on the local computer on port 9090
var rbServer = new ROSLIB.Ros({
    url : 'ws://127.0.0.1:9090'
 });

 // This function is called upon the rosbridge connection event
 rbServer.on('connection', function() {
     // Write appropriate message to #feedback div when successfully connected to rosbridge
     var fbDiv = document.getElementById('feedback');
     fbDiv.innerHTML += "<p>Connected to websocket server.</p>";
 });

// This function is called when there is an error attempting to connect to rosbridge
rbServer.on('error', function(error) {
    // Write appropriate message to #feedback div upon error when attempting to connect to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Error connecting to websocket server.</p>";
});

// This function is called when the connection to rosbridge is closed
rbServer.on('close', function() {
    // Write appropriate message to #feedback div upon closing connection to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Connection to websocket server closed.</p>";
 });

// These lines create a topic object as defined by roslibjs
var cmdVelTopic = new ROSLIB.Topic({
    ros : rbServer,
    name : '/turtle1/cmd_vel',
    messageType : 'geometry_msgs/Twist'
});

// These lines create a message that conforms to the structure of the Twist defined in our ROS installation
// It initalizes all properties to zero. They will be set to appropriate values before we publish this message.
var twist = new ROSLIB.Message({
    linear : {
        x : 0.0,
        y : 0.0,
        z : 0.0
    },
    angular : {
        x : 0.0,
        y : 0.0,
        z : 0.0
    }
});

/* This function:
 - retrieves numeric values from the text boxes
 - assigns these values to the appropriate values in the twist message
 - publishes the message to the cmd_vel topic.
 */
function pubMessage(a) {
    /**
    Set the appropriate values on the twist message object according to values in text boxes
    It seems that turtlesim only uses the x property of the linear object 
    and the z property of the angular object
    **/
    var linearX = 0.0;
    var angularZ = 0.0;

    // get values from text input fields. Note for simplicity we are not validating.

switch(a){
case 0:
    linearX = 0 + Number(document.getElementById('linearXText').value);
    angularZ = 0 + Number(document.getElementById('angularZText').value);
case 1:
    linearX = 2;
    angularZ = 0; 
break;
case 2:
    linearX = -2;
    angularZ = 0; 
break;
case 3:
    linearX = 0;
    angularZ = 2; 
break;
case 4:
    linearX = 0;
    angularZ = -2; 
break;
}
    // Set the appropriate values on the message object
    twist.linear.x = linearX;
    twist.angular.z = angularZ;
    // Publish the message 
    cmdVelTopic.publish(twist);
return
}

function myFunction(event) {
    var x = event.which || event.keyCode;
    switch(x){
	case 38:
		pubMessage(1);
	break
	case 37:
		pubMessage(3);
	break
	case 39:
		pubMessage(4);
	break
	case 40:
		pubMessage(2);
	break
}
return		
}



</script>

<style>
h2{ color: blue;
    font-family: verdana;
    font-size: 300%;
    text-align:center;
}
pre{
text-align:center;
}
img {
width:304px;height:228px;float:right;
}
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    background-color: #f1f1c1;
}
th, td {
    padding: 5px;
    text-align: left;    
}
</style>

</head>
<title>turtle</title>
<body>
<h1 style="text-align:center;background-color:red">turtle</h1>
<img src="/home/allen/line.jpg" alt="no pi" >
<canvas id="player"> </canvas>
<p style="color:red;font-size:36px">gogo</p><br>
<pre>i <abbr title="no" style="color:red" >can</abbr> do</pre>
<a href="turtle.html"target="_blank">new</a>

<a href="turtle.html"target="_top">reflash</a>

<hr>
<hr>
<form name="ctrlPanel">
<p style="text-align:center;">
<button id="sendMsg1"title="go up" type="button" onclick= "pubMessage(1)">up</button><br>
<button id="sendMsg3" type="button" onclick="pubMessage(3)">left</button>
<button id="sendMsg2" type="button" onclick= "pubMessage(2)">down</button>
<button id="sendMsg4" type="button" onclick="pubMessage(4)">right</button>
</p>
<p>for keyboard</p>
<input type="text" size="1" onkeypress="myFunction(event)">

<p>use number</p>
<table style="width:10">
 <tr><td> X</td><td><input id="linearXText"  size="1" name="linearXText" type="text"/></td></tr>
 <tr><td> Z</td><td><input id="angularZText" size="1" name="angularZText" type="text"/></td></tr>
</table>
<button id="sendMsg" type="button" onclick="pubMessage(0)">go turtle</button>


</form>
<div id="feedback"></div>
</body>
<script src="js/video.js"></script>
</html>
